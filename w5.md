# W5. `Mar06 - Mar10`

Esta semana se comienza a implementar el Core del Liqen: una API REST implementada usando el framework Phoenix con el lenguaje Elixir. Concretamente, esta semana se desarrollan los temas:

- Autenticación de usuarios
- El recurso `Article`
- El recurso `Tag`

## El framework

Para la implementación del núcleo de Liqen, se ha elegido un framework web: [Phoenix](http://www.phoenixframework.com) implementado en el lenguaje Elixir.

Las ventajas del binomio Elixir-Phoenix son numerosas:

1. Los programas en Elixir se ejecutan en la [máquina virtual de Erlang](http://www.erlang.org/) permitiendo alta tolerancia a fallos, concurrencia de facto y comunicación en tiempo real.

2. El la sintaxis del lenguaje Elixir es similar a Ruby.

3. El framework Phoenix es similar al framework Ruby on Rails pero con mayor desacoplamiento entre Modelo, Vista y Controlador.

4. El framework organiza el código sobre la idea de `Plug`, una serie de módulos independientes entre sí.

    ```
    connection
    |> endpoint
    |> routes
    |> pipelines
    |> controller
    ```

## Autenticación de usuarios

Para tener una base que más adelante se irá ampliando y complicando, se decide implementar un sistema de usuarios muy básico. Este sistema solamente permite iniciar sesión y realizar operaciones para las que el usuario tiene que haber iniciado sesión.

Para comenzar, no se contempla ni la creación de usuarios ni un sistema en el que se diferencien "tipos" de usuarios (administradores, entrevistadores, etc.)

Se recurre a JSON Web Tokens para implementar este mecanismo. Se utiliza la biblioteca [Guardian](https://github.com/ueberauth/guardian) para ello.

Para la primera iteración se decide implantar Tokens *sin estado*. Hay ciertas desventajas en esta decisión que en un futuro se deberán subsanar:

- El sistema no cuenta con un sistema de validación de e-mails. No se comprueba que el dato introducido (e-mail) es correcto. Tampoco se permite recuperar la contraseña.
- El sistema no permite cerrar sesión. Pese a que cada vez que se inicia sesión, se genera un token nuevo, no se puede eliminar un token antiguo explícitamente, lo cual puede suponer un agujero de seguridad.

## Recursos Article y Tag

![](http://www.plantuml.com/plantuml/png/jOzD2W8n38NtFKMMYimL1F4ANg2seLEipT16HXcyktNwWwFYpbNUIyYNbq6gapG8PzBe8am2G3aP8-m2M-LmxW1ihCwLBJlCyaZwbfNgfJSOaLVhrBYB1Zb8ymFmlfOMXn97aUT0pc7uacdVXWtkDLvdIZAnfx5g5L0oLdSPz8jB3sDnoyZ_uASBItAdQVJTzdbFVFvLfsNo0000)

Ambos recursos son los más sencillos de todo el sistema. En parte porque no dependen de ningún otro.

Un artículo es un objeto que representa un documento de texto que puede ser, por ejemplo, una noticia, un artículo de opinión o un post de un blog. Tiene dos campos: `title` y  `body` que son el título y cuerpo del artículo respectivamente.

Por otro lado, una etiqueta es una manera de categorizar todos los demás objetos del sistema. Solamente tiene un campo `title`, que es un nombre descriptivo para la etiqueta.

Automáticamente, todos los recursos llevan un identificador `:id` que los identifica unívocamente.

Dado que Liqen es una API RESTful, artículo y etiqueta deben ser recursos. Concretamente los recursos `/articles/:id` y `/tags/:id` y las colecciones `/articles` y `/tags`. Además se deben implementar las operaciones para leer, crear, actualizar y borrar recursos. En definitiva, los siguientes verbos HTTP:

Verbo HTTP | Endpoint HTTP | Descripción
:--------- | :------------ | :----------
GET        | /articles     | Obtener una lista de todos los artículos
GET        | /articles/:id | Obtener el artículo cuyo ID es `:id`
POST       | /articles     | Crear un nuevo artículo
PUT        | /articles/:id | Modificar el artículo cuyo ID es `:id`
DELETE     | /articles/:id | Eliminar el artículo cuyo ID es `:id`

(lo mismo para etiquetas sustituyendo `articles` por `tags`)

En Phoenix, los modelos se encargan de la lógica que hay en los objetos como tales. En este caso, que los campos de ambos objetos son obligatorios.

Los controladores, gestionan las diferentes operaciones mencionadas. Son módulos con funciones asociados a las mismas:

Verbo HTTP | Endpoint HTTP | Nombre de la función
:--------- | :------------ | :----------
GET        | /articles     | index
GET        | /articles/:id | show
POST       | /articles     | create
PUT        | /articles/:id | update
DELETE     | /articles/:id | delete

